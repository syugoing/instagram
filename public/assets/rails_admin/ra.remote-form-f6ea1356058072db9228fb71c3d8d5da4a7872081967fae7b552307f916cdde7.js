!function(t){t.widget("ra.remoteForm",{_create:function(){var e=this,n=e.element,i=n.find("select").first().data("options")&&n.find("select").first().data("options")["edit-url"];"undefined"!=typeof i&&i.length&&n.on("dblclick",".ra-multiselect option:not(:disabled)",function(t){e._bindModalOpening(t,i.replace("__ID__",this.value))}),n.find(".create").unbind().bind("click",function(n){e._bindModalOpening(n,t(this).data("link"))}),n.find(".update").unbind().bind("click",function(i){(value=n.find("select").val())?e._bindModalOpening(i,t(this).data("link").replace("__ID__",value)):i.preventDefault()})},_bindModalOpening:function(e,n){if(e.preventDefault(),widget=this,t("#modal").length)return!1;var i=this._getModal();setTimeout(function(){t.ajax({url:n,beforeSend:function(t){t.setRequestHeader("Accept","text/javascript")},success:function(t){i.find(".modal-body").html(t),widget._bindFormEvents()},error:function(t){i.find(".modal-body").html(t.responseText)},dataType:"text"})},200)},_bindFormEvents:function(){var e=this,n=this._getModal(),i=n.find("form"),o=n.find(":submit[name=_save]").html(),r=n.find(":submit[name=_continue]").html();n.find(".form-actions").remove(),i.attr("data-remote",!0),n.find(".modal-header-title").text(i.data("title")),n.find(".cancel-action").unbind().click(function(){return n.modal("hide"),!1}).html(r),n.find(".save-action").unbind().click(function(){return i.submit(),!1}).html(o),t(document).trigger("rails_admin.dom_ready",[i]),i.bind("ajax:complete",function(i,o,r){if("error"==r)n.find(".modal-body").html(o.responseText),e._bindFormEvents();else{var s=t.parseJSON(o.responseText),a='<option value="'+s.id+'" selected>'+s.label+"</option>",l=e.element.find("select").filter(":hidden");if(e.element.find(".filtering-select").length){var u=e.element.find(".filtering-select").children(".ra-filtering-select-input");u.val(s.label),l.find("option[value="+s.id+"]").length||(l.html(a).val(s.id),e.element.find(".update").removeClass("disabled"))}else{var u=e.element.find(".ra-filtering-select-input"),d=e.element.find(".ra-multiselect");d.find("option[value="+s.id+"]").length?(l.find("option[value="+s.id+"]").text(s.label),d.find("option[value= "+s.id+"]").text(s.label)):(l.append(a),d.find("select.ra-multiselect-selection").append(a))}e._trigger("success"),n.modal("hide")}})},_getModal:function(){var e=this;return e.dialog||(e.dialog=t('<div id="modal" class="modal fade">            <div class="modal-dialog">            <div class="modal-content">            <div class="modal-header">              <a href="#" class="close" data-dismiss="modal">&times;</a>              <h3 class="modal-header-title">...</h3>            </div>            <div class="modal-body">              ...            </div>            <div class="modal-footer">              <a href="#" class="btn cancel-action">...</a>              <a href="#" class="btn btn-primary save-action">...</a>            </div>            </div>            </div>          </div>').modal({keyboard:!0,backdrop:!0,show:!0}).on("hidden.bs.modal",function(){e.dialog.remove(),e.dialog=null})),this.dialog}})}(jQuery);